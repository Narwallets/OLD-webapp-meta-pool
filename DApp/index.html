<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>MetaStaking Pool</title>
    <link rel="stylesheet" href="css/hamb.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/index.css">
</head>

<body>
    <div class="app">

        <div class="app-header">
            <h2>MetaStaking Pool</h2>
            <span id="connection-info" class="info-div">Not Connected</span>
        </div>

        <div class="app-contents">

            <!-- Main Page, Dashboard -->
            <div id="initial-page" class="page slide-hide hidden">
                <h2 class="page-header">Welcome!</h2>

                <h3>Please connect a wallet to interact with this DApp</h3>

                <div id="main-buttons" class="footer button-group">
                    <button id="how-to-connect-a-wallet" class="button btn-primary">
                        How to connect a wallet
                    </button>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard-page" class="page slide-hide hidden">
                <h2 class="page-header">Dashboard</h2>

                <div id="dashboard">
                </div>

                <div id="dashboard-buttons" class="footer button-group">
                    <button id="refresh-dashboard" class="button btn-primary">
                        Refresh Dashboard
                    </button>
                    <button id="enter-my-account" class="button btn-primary">
                        My Account
                    </button>
                </div>

                <!-- Dashboard Template -->
                <div id="dashboard-template" class="hidden label-value-content">
                    <div class="label-value">
                        <label>Location</label>
                        <div>{location}</div>
                    </div>
                    <div class="label-value">
                        <label>Total Funds</label>
                        <div class="balance">{total}</div>
                    </div>
                    <div class="label-value">
                        <label>Historic Rewards</label>
                        <div class="balance">{historicRewards}</div>
                    </div>
                    <div class="label-value">
                        <label>stNEARs/Staked</label>
                        <div class="balance">{stnear}</div>
                    </div>
                    <div class="label-value">
                        <label>NEAR/stNEAR Liquidity</label>
                        <div class="balance">{nslp_liquidity}</div>
                    </div>
                    <div class="label-value">
                        <label>Sell stNEAR current discount</label>
                        <div class="pct">{nslp_current_discount}</div>
                    </div>
                    <!--<div class="label-value">
                        <label>Time to rewards distribution</label>
                        <div class="timespan">{timeToRewardsString}</div>
                    </div>
                    -->
                    <div class="label-value">
                        <label>Number of pools</label>
                        <div class="number">{numberOfPools}</div>
                    </div>
                    <!--
                    <div class="label-value">
                        <label>Average Fee</label>
                        <div class="pct">{averageFee}</div>
                    </div>
                    -->
                </div>

            </div>

            <!-- My Account Page -->
            <div id="my-account" class="account-selected page slide-hide hidden">
                <header class="back-link">Back to Dashboard</header>
                <div id="my-account-info" class="my-account-info">
                </div>

                <!-- Template -->
                <div id="my-account-template" class="label-value-content hidden">
                    <div class="label-value">
                        <label>Account</label>
                        <div class="account">{nearAccount}</div>
                    </div>
                    <div id="available-balance-line" class="label-value">
                        <label>Available</label>
                        <div class="balance">{available}</div>
                    </div>
                    <div class="label-value">
                        <label>stNEARs/Staked</label>
                        <div class="balance">{stnear}</div>
                    </div>
                    <div class="label-value">
                        <label>Unstaked</label>
                        <div class="balance">{unstaked}</div>
                    </div>
                    <div id="wait-to-withdraw" class="label-value hidden">
                        <label>Wait to withdraw</label>
                        <div class="timespan">{remainingTimeString}</div>
                    </div>
                    <div class="label-value">
                        <label>Rewards since</label>
                        <div class="datetime">{tripMeterStart}</div>
                    </div>
                    <div class="label-value">
                        <label>Rewards</label>
                        <div class="balance">{tripMeterRewards}</div>
                    </div>
                    <div class="label-value">
                        <label>METAs</label>
                        <div class="balance meta">{meta}</div>
                    </div>
                </div>


                <div id="my-account-supages" class="footer">

                    <!-- Buttons -->
                    <div id="account-selected-buttons" class="subpage hidden">
                        <div class="group-title">Deposit</div>
                        <div class="button-group">
                            <button id="deposit">Deposit</button>
                            <button id="deposit-and-stake">Deposit & Buy stNEAR<br><small>(Deposit & Stake)</small></button>
                        </div>
                        <div class="group-title">Account</div>
                        <div class="button-group">
                            <button id="stake">Buy stNEAR<br><small>(Stake with Available)</small></button>
                            <button id="sell">Sell stNEAR<br><small>(Immediate Unstake)</small></button>
                        </div>
                        <div class="button-group no-top-line">
                            <button id="refresh-account">Refresh</button>
                            <button id="withdraw">Withdraw</button>
                        </div>
                        <div class="group-title">Classic Unstake</div>
                        <div class="button-group">
                            <button id="start-unstake">Start Unstake<br><small>(and wait 50hs)</small></button>
                            <button id="complete-unstake">Finish Unstake<br><small>(move to Available)</small></button>
                        </div>
                        <div class="group-title">Advanced</div>
                        <div class="button-group">
                            <button id="enter-ns-liquidity-provider">Liquidity Providers</button>
                            <button id="enter-vloan">Validator Staking Loans</button>
                        </div>
                    </div>


                    <!-- SUBPAGES -->

                    <!-- Deposit NEAR -->
                    <div id="deposit-subpage" class="subpage hidden">
                        <h1>Deposit NEAR</h1>
                        <div class="subtitle">
                            <h3 class="success">You need to deposit some NEAR in this smart contract to be able to buy
                                stNEAR/Stake.
                                Your funds are secure and available. You can withdraw your available NEARS at any time.
                            </h3>
                        </div>
                        <div class="deposit-form">
                            <div class="form-field-label">
                                <label for="deposit-amount">
                                    Amount in NEAR to deposit
                                </label>
                                <div class="form-control">
                                    <input id="deposit-amount" inputmode="numeric">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- WITHDRAW NEAR -->
                    <div id="withdraw-subpage" class="subpage hidden">
                        <h1>Withdraw NEAR</h1>
                        <div class="subtitle">
                            <h3 class="success">You can withdraw from your available balance.</h3>
                        </div>
                        <div class="withdraw-form">
                            <div class="form-field-label">
                                <label for="withdraw-amount">
                                    Amount in NEAR to withdraw (Max <span id="max-withdraw"></span>)
                                </label>
                                <div class="form-control">
                                    <input id="withdraw-amount" inputmode="numeric">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- subpage DEPOSIT AND STAKE -->
                    <div id="deposit-and-stake" class="subpage hidden">
                        <h1>Buy stNEAR/Stake</h1>
                        <div>
                            <div class="form-field-label">
                                <label for="deposit-and-stake">
                                    Amount in NEAR
                                </label>
                                <div class="form-control">
                                    <input id="deposit-and-stake" inputmode="numeric">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- subpage BUY stNEAR/STAKE -->
                    <div id="buy-stake-stnear" class="subpage hidden">
                        <h1>Buy stNEAR/Stake</h1>
                        <div>
                            <div class="form-field-label">
                                <label for="buy-stake-amount">
                                    Amount in NEAR (Max <span id="buy-stake-max"></span>)
                                </label>
                                <div class="form-control">
                                    <input id="buy-stake-amount" inputmode="numeric">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- subpage SELL stNEAR -->
                    <div id="sell-stnear" class="subpage hidden">
                        <h1>Sell stNEAR</h1>
                        <div>
                            <div class="form-field-label">
                                <label for="sell-amount">
                                    stNEAR Amount to sell (Max <span id="sell-stnear-max"></span>)
                                </label>
                                <div class="form-control">
                                    <input id="sell-amount" inputmode="numeric">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- subpage SELL stNEAR/STAKE CONFIRM DISCOUNTED -->
                    <div id="sell-stnear-confirmation" class="subpage hidden">
                        <h1>Confirm stNEAR Sell</h1>
                        <div class="subtitle">
                            <div id="original-sell-confirmation-near" class="hidden"></div>
                            <h3 class="warning">Sell <span id="sell-confirmation-stnear"></span> stNEAR
                                to obtain at least <span id="sell-confirmation-near"></span> NEAR ?</h3>
                        </div>
                        <br>
                        <div class="form-field-label">
                            <label for="sell-slippage">Slippage <span class="pct" id="sell-slippage-display"></span></label>
                            <input type="range" id="sell-slippage" min="0" max="10">
                        </div>
                    </div>


                    <!-- subpage UNSTAKE and WAIT -->
                    <div id="unstake" class="subpage hidden">
                        <h1>Classic unstake</h1>
                        <div class="subtitle">
                            <h3 class="warning">There is a non-cancellable waiting period of 42-54hs for the funds to be
                                available</h3>
                        </div>
                        <br>
                        <div class="form-field-label">
                            <label for="unstake-amount">
                                Amount to unstake
                            </label>
                            <div class="form-control">
                                <input id="unstake-amount" inputmode="numeric">
                            </div>
                        </div>
                    </div>

                    <!-- subpage UNSTAKE CONFIRMATION -->
                    <div id="sell-stnear-confirmation" class="subpage hidden">
                        <h1>Confirm Unstake</h1>
                        <div class="subtitle">
                            <h3 class="warning">Warning: There is a non-cancellable waiting period of 36-48hs for the
                                funds
                                to be available</h3>
                        </div>
                        <br>
                        <div class="subtitle">
                            <h3 class="warning">Initiate unstaking process for <span
                                    id="unstake-confirmation-amount"></span> NEAR?</h3>
                        </div>
                    </div>
                </div>
                <div id="ok-cancel-placeholder" class="footer"></div>

            </div>

            <!-- ----------------------------------------------
                NEAR/stNEAR LIQUIDITY POOL PAGE
            --------------------------------------------------- -->
            <div id="nslp-page" class="nslp-page page slide-hide hidden">
                <header class="back-link">Back to My Account</header>
                <h2 class="page-header">NEAR/stNEAR Liquidity Pool</h2>
                <div id="nslp-info" class="nslp-info">
                </div>

                <!-- Template -->
                <div id="nslp-template" class="label-value-content hidden">
                    <div class="label-value">
                        <label>Liquidity Pool</label>
                        <div class="account">{poolName}</div>
                    </div>
                    <div id="available-balance-line" class="label-value">
                        <label>NEAR in the Pool</label>
                        <div class="balance">{available}</div>
                    </div>
                    <div class="label-value">
                        <label>stNEARs in the Pool</label>
                        <div class="balance">{stnear}</div>
                    </div>
                    <div class="label-value">
                        <label>Unstaked in the Pool</label>
                        <div class="balance">{unstaked}</div>
                    </div>
                    <div class="label-value">
                        <label>Current Discount Fee</label>
                        <div class="pct">{discount}</div>
                    </div>
                    <div class="label-value top-line">
                        <label>Your Share</label>
                        <div class="pct">{yourSharePct}</div>
                    </div>
                    <div class="label-value">
                        <label>Your share value</label>
                        <div class="balance">{user.nslp_share_value}</div>
                    </div>
                    <div class="label-value top-line">
                        <label>Your account available</label>
                        <div class="balance">{user.available}</div>
                    </div>
                    
                </div>


                <div id="nslp-supages" class="footer">

                    <!-- Buttons -->
                    <div id="nslp-buttons" class="subpage hidden">
                        <div class="button-group no-top-line">
                            <button id="add-liquidity">Add Liquidity</button>
                            <button id="remove-liquidity">Remove Liquidity</button>
                        </div>
                    </div>

                    <!-- SUBPAGES -->

                    <!-- add liquidity -->
                    <div id="add-liquidity" class="subpage hidden">
                        <h1>Add NEAR liquidity</h1>
                        <div class="subtitle">
                            <h3 class="success">Adding liquidity you'll receive a share of the liquidity pool. 
                                On each operation you'll get a fee and also $META tokens
                            </h3>
                        </div>
                        <div class="deposit-form">
                            <div class="form-field-label">
                                <label for="add-liquidity-amount">
                                    Amount in NEAR to add (Max <span id="add-liquidity-max"></span>)
                                </label>
                                <div class="form-control">
                                    <input id="add-liquidity-amount" inputmode="numeric">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- remove liquidity -->
                    <div id="remove-liquidity" class="subpage hidden">
                        <h1>Remove Liquidty</h1>
                        <div class="subtitle">
                            <h3 class="success">You will burn shares from the liquidity pool. 
                                You'll receive stNEAR (staked NEAR), unstaked near (waiting period)
                                and finally NEAR in proportion to the shares you're burning.</h3>
                        </div>
                        <div class="remove-liquidity-form">
                            <div class="form-field-label">
                                <label for="remove-liquidity-amount">
                                    Amount in NEAR to remove (Max <span id="remove-liquidity-max"></span>)
                                </label>
                                <div class="form-control">
                                    <input id="remove-liquidity-amount" inputmode="numeric">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div id="ok-cancel-placeholder" class="footer"></div>

            </div>

            <!-- ----------------------------------------------
                VALIDATOR LOANS PAGE
            --------------------------------------------------- -->
            <div id="vloan-page" class="vloan-page page slide-hide hidden">
                <header class="back-link">Back to My Account</header>
                <h2 class="page-header">Validator Stake Loan Request</h2>
                <div class="subtitle">
                    <h3 class="success">
                    <p>This page allows you to add your signature to confirm a validator loan request, but you don't need to sign this transaction to start a request process. 
                    Start the process by asking at <a target="_blank" href="https://discord.gg/BJq6mxywwK">Narwallets' discord</a> <b>#meta-val-stake-loans</b> channel.
                    </p>
                </div>
                <div id="vloan-info" class="vloan-info">
                </div>

                <!-- Template -->
                <div id="vloan-template" class="label-value-content hidden">
                    <div class="label-value  top-line">
                        <label>Status</label>
                        <div class="text">{status_text}</div>
                    </div>
                    <div class="label-value top-line">
                        <label>Staking pool's Owner Id</label>
                        <div class="account">{staking_pool_owner_id}</div>
                    </div>
                    <div class="label-value top-line">
                        <label>Staking pool</label>
                        <div class="account">{raw.staking_pool_account_id}</div>
                    </div>
                    <div id="available-balance-line" class="label-value">
                        <label>Amount Requested</label>
                        <div class="balance">{amount_requested_near}</div>
                    </div>
                    <div class="label-value">
                        <label>Information URL</label>
                        <div class="text">{raw.information_url}</div>
                    </div>
                    <div class="label-value top-line">
                        <label>Commited Fee %</label>
                        <div class="pct">{commited_fee}</div>
                    </div>
                    <div class="label-value">
                        <label>Commited Fee Duration (Epochs)</label>
                        <div class="number">{raw.commited_fee_duration}</div>
                    </div>
                    <div class="label-value top-line">
                        <label>Loan Fee</label>
                        <div class="balance">{loan_fee_near}</div>
                    </div>
                    
                </div>


                <div id="vloan-supages" class="footer">

                    <!-- Buttons -->
                    <div id="vloan-buttons" class="subpage hidden">
                        <div class="button-group no-top-line">
                            <button id="vloan-modify-request">Modify Request Data</button>
                            <button id="vloan-activate-request">Activate</button>
                            <button id="vloan-deactivate-request">Convert back to Draft</button>
                        </div>
                        <div class="button-group no-top-line">
                            <button id="vloan-take">Accept Fee & Take Loan</button>
                        </div>
                        <div class="button-group no-top-line">
                            <button id="vloan-delete">Delete Loan Request</button>
                        </div>
                    </div>

                    <!-- SUBPAGES -->

                    <div id="vloan-activate" class="subpage hidden">
                        <h2>Activate Request</h2>
                        <div class="subtitle">
                            <h3 class="success">
                            <p>Activating the request will start the in-chain approval process.
                            Activating a request has a <b>5N fee</b> and you won't be able to modify data or deactivate for 2 Epochs (24hs).
                            </p>
                            </h3>
                        </div>
                    </div>

                    <div id="vloan-deactivate" class="subpage hidden">
                        <h2>Convert back to DRAFT</h2>
                        <div class="subtitle">
                            <h3 class="success">
                            <p>If the request is active, you can convert back to DRAFT status only after 2 Epochs (72hs) from the activation. 
                            </p>
                            </h3>
                        </div>
                    </div>

                    <div id="vloan-delete" class="subpage hidden">
                        <h2>Delete Staking Loan Request</h2>
                        <div class="subtitle">
                            <h3 class="success">
                            <p>Click OK to delete the Staking Loan Request
                            </p>
                            </h3>
                        </div>
                    </div>

                    <div id="vloan-take" class="subpage hidden">
                        <h2>Deactivate Request</h2>
                        <div class="subtitle">
                            <h3 class="success">
                            <p>If your request is APPROVED, by clicking OK <b>you will pay the Loan Fee</b> and staking will start. 
                                Click OK if you agree.
                            </p>
                            </h3>
                        </div>
                    </div>


                    <!-- vloan-modify-request -->
                    <div id="vloan-modify" class="subpage hidden">
                        <h2>Modify Request</h2>
                        <div class="modify-form">
                            <div class="form-field-label">
                                <label for="staking_pool_account_id">Staking Pool Account Id</label>
                                <div class="form-control"><input id="staking_pool_account_id" type="text"></div>
                            </div>
                            <div class="form-field-label">
                                <label for="vloan_amount_near">Amount in NEAR Staking requested</label>
                                <div class="form-control"><input id="vloan_amount_near" inputmode="numeric"></div>
                            </div>
                            <div class="form-field-label">
                                <label for="information_url">Information URL</label>
                                <div class="form-control"><input id="information_url" type="text"></div>
                            </div>
                            <div class="form-field-label">
                                <label for="commited_fee">Commited Fee</label>
                                <div class="form-control"><input id="commited_fee" inputmode="numeric"></div>
                            </div>
                            <div class="form-field-label">
                                <label for="commited_fee">Commited Fee Duration (Epochs)</label>
                                <div class="form-control"><input id="commited_fee_duration" inputmode="numeric"></div>
                            </div>
                            <!--<div class="form-field-label">
                                <label for="status">Status</label>
                                <div class="form-control">
                                    <select name="status" id="vloan-status">
                                        <option value="0">DRAFT</option>
                                        <option value="1">ACTIVE</option>
                                        <option value="2">REJECTED</option>
                                        <option value="3">ACCEPTED</option>
                                        <option value="4">EXECUTED</option>
                                      </select>
                                    </div>
                            </div>
                            -->
                        </div>
                    </div>

                </div>

                <div id="ok-cancel-placeholder" class="footer"></div>

            </div>

            <!-- OK CANCEL buttons component -->
            <div id="ok-cancel" class="component">
                <div class="button-group ok-cancel hidden no-top-line">
                    <button id="ok" class="button btn-primary">
                        OK
                    </button>
                    <button id="cancel" class="button btn-cancel">
                        Cancel
                    </button>
                </div>
            </div>


        </div> <!-- end app-contents -->
    </div> <!-- end app-->


    <!-- -->
    <div id="err-div"></div>
    <!-- -->
    <div id="wait">
        <div class="lds-ring">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <script type="module" src="dist/index.js"></script>

</body>

</html>